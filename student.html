<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Blaiz'bot - Espace √âl√®ve</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Redirection vers la page de connexion si acc√®s direct ou refresh
        if (!sessionStorage.getItem('authenticated')) {
            window.location.href = 'index.html';
        }
        sessionStorage.removeItem('authenticated');
    </script>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar Lat√©rale -->
        <aside class="sidebar" style="background-color: #34495e;"> <!-- Bleu fonc√© pour l'√©l√®ve -->
            <div class="sidebar-header">
                <h2>Blaiz'bot</h2>
                <p>Espace √âl√®ve</p>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <span>MON PARCOURS</span>
                    <a href="#" class="nav-link active" data-section="dashboard">Ma Progression</a>
                    <a href="#" class="nav-link" data-section="cours">Mes Cours</a>
                    <a href="#" class="nav-link" data-section="exercices">Mes Exercices</a>
                    <a href="#" class="nav-link" data-section="messages">Centre de Communication <span class="status-pill" style="background: #e74c3c; color: white; padding: 2px 6px; font-size: 0.7rem; margin-left: 5px;">1</span></a>
                </div>
                <div class="nav-group">
                    <span>ASSISTANCE IA</span>
                    <a href="#" class="nav-link" data-section="chatbot">Mon Assistant IA</a>
                    <a href="#" class="nav-link" data-section="lab">Blaiz'bot Lab (Libre)</a>
                    <a href="#" class="nav-link" data-section="knowledge">Base de connaissances</a>
                    <a href="#" class="nav-link" data-section="revisions">Planning de R√©vision</a>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div style="padding: 10px; font-size: 0.8rem; color: #ecf0f1; border-bottom: 1px solid #5d6d7e; margin-bottom: 10px;">
                    Connect√© en tant que :<br><strong>Lucas PETIT (6√®me A)</strong>
                </div>
                <a href="index.html" class="btn-logout">D√©connexion</a>
            </div>
        </aside>

        <!-- Zone de Travail Principale -->
        <main class="main-content">
            
            <!-- SECTION : DASHBOARD / PROGRESSION -->
            <section id="section-dashboard" class="admin-section active">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Salut Lucas ! üëã</h1>
                        <p>Tu as compl√©t√© 75% de tes objectifs cette semaine. Continue comme √ßa !</p>
                    </div>
                </header>

                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Progression Globale</h3>
                        <div class="stats-value">75%</div>
                        <div class="performance-bar-container">
                            <div class="performance-bar" style="width: 75%; background-color: #2ecc71;"></div>
                        </div>
                        <p style="font-size: 0.8rem; color: #7f8c8d;">+5% depuis hier</p>
                    </div>
                    <div class="stats-card">
                        <h3>Moyenne Actuelle</h3>
                        <div class="stats-value">15.2/20</div>
                        <p>Excellent travail en Math√©matiques !</p>
                    </div>
                    <div class="stats-card">
                        <h3>√Ä faire aujourd'hui</h3>
                        <div class="stats-value" style="font-size: 1.5rem;">3 Devoirs</div>
                        <ul class="stats-list">
                            <li>Maths : Exercice fractions</li>
                            <li>Fran√ßais : Lecture chapitre 4</li>
                        </ul>
                    </div>
                </div>

                <div class="data-table-container">
                    <h3>Derni√®res Notes</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mati√®re</th>
                                <th>√âvaluation</th>
                                <th>Note</th>
                                <th>Commentaire IA</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Math√©matiques</td>
                                <td>Nombres relatifs</td>
                                <td><strong>18/20</strong></td>
                                <td><span class="tag" style="background: #e8f5e9; color: #2e7d32;">Ma√Ætris√©</span></td>
                            </tr>
                            <tr>
                                <td>Anglais</td>
                                <td>Vocabulaire : The City</td>
                                <td><strong>14/20</strong></td>
                                <td><span class="tag" style="background: #fff3e0; color: #ef6c00;">√Ä revoir : Verbes irr√©guliers</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SECTION : MES COURS -->
            <section id="section-cours" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Mes Cours</h1>
                        <p>Acc√®de √† tous tes supports de cours</p>
                    </div>
                </header>
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Math√©matiques</h3>
                        <p>Dernier chapitre : Les fractions</p>
                        <button class="btn-primary" style="width: 100%; margin-top: 10px;" onclick="openCoursContent('Math√©matiques', 'Les fractions')">Ouvrir le cours</button>
                    </div>
                    <div class="stats-card">
                        <h3>Fran√ßais</h3>
                        <p>Dernier chapitre : La po√©sie</p>
                        <button class="btn-primary" style="width: 100%; margin-top: 10px;" onclick="openCoursContent('Fran√ßais', 'La po√©sie')">Ouvrir le cours</button>
                    </div>
                </div>
            </section>

            <!-- SECTION : CHATBOT IA -->
            <section id="section-chatbot" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Mon Assistant IA Blaiz'bot</h1>
                        <p>Acc√®de aux environnements de cours pr√©par√©s par tes professeurs.</p>
                    </div>
                    <div class="header-actions" id="assistant-header-actions" style="display: none;">
                        <!-- Les cours sont g√©r√©s par le professeur -->
                    </div>
                </header>

                <!-- VUE 1 : DASHBOARD ASSISTANT -->
                <div id="assistant-dashboard" style="padding: 20px;">
                    <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; color: #1565c0; font-size: 0.9rem; display: flex; align-items: center; gap: 10px;">
                        <span>‚ÑπÔ∏è</span>
                        <span>Voici les espaces de travail d√©pos√©s par tes professeurs. S√©lectionne un cours pour commencer tes r√©visions.</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;" id="assistant-projects-grid">
                        <!-- Les cours du professeur s'afficheront ici -->
                    </div>
                </div>

                <!-- VUE 2 : WORKSPACE ASSISTANT -->
                <div id="assistant-workspace-view" style="display: none;">
                    <div style="padding: 0 20px 15px; display: flex; align-items: center; gap: 15px;">
                        <button class="btn-secondary" onclick="showAssistantDashboard()" style="padding: 5px 10px; font-size: 0.8rem;">‚Üê Retour aux cours</button>
                        <h2 id="current-assistant-title" style="margin: 0; font-size: 1.1rem; color: #2c3e50;">Cours : Les Fractions</h2>
                    </div>

                    <div class="lab-container" id="assistant-container">
                        <!-- Colonne 1 : Sources (Prof + √âl√®ve) -->
                        <div class="lab-column" style="width: 280px; min-width: 280px;" id="assistant-col-sources">
                        <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; font-size: 0.9rem;">üìö Sources</h4>
                            <button class="btn-primary" style="padding: 4px 8px; font-size: 0.7rem; background: #3498db; border: none;" onclick="promptAddAssistantSource()">+ Ajouter</button>
                        </div>
                        <div id="assistant-sources-list" style="flex-grow: 1; overflow-y: auto; padding: 15px;">
                            <!-- Sources Professeur (Verrouill√©es) -->
                            <div style="font-size: 0.7rem; color: #7f8c8d; text-transform: uppercase; margin-bottom: 10px; font-weight: bold;">üìå Sources du Professeur</div>
                            <div class="source-item" style="background: #f0f7ff; border-color: #d1e9ff;">
                                <div class="source-icon icon-pdf">üìÑ</div>
                                <span style="flex-grow: 1; font-size: 0.8rem;">Cours_Fractions.pdf</span>
                                <span title="Source impos√©e" style="cursor: help;">üîí</span>
                            </div>
                            <div class="source-item" style="background: #f0f7ff; border-color: #d1e9ff;">
                                <div class="source-icon icon-pdf">üìÑ</div>
                                <span style="flex-grow: 1; font-size: 0.8rem;">Exercices_Fractions.pdf</span>
                                <span title="Source impos√©e" style="cursor: help;">üîí</span>
                            </div>
                            <div class="source-item" style="background: #f0f7ff; border-color: #d1e9ff;">
                                <div class="source-icon icon-yt">üé•</div>
                                <span style="flex-grow: 1; font-size: 0.8rem;">Video_Methode.yt</span>
                                <span title="Source impos√©e" style="cursor: help;">üîí</span>
                            </div>

                            <!-- Sources √âl√®ve -->
                            <div style="font-size: 0.7rem; color: #7f8c8d; text-transform: uppercase; margin: 15px 0 10px; font-weight: bold;">üë§ Mes Sources</div>
                            <div id="assistant-student-sources">
                                <div style="text-align: center; color: #95a5a6; font-size: 0.75rem; margin-top: 10px;">Aucune source perso.</div>
                            </div>
                        </div>
                        <div style="padding: 12px; background: #e3f2fd; font-size: 0.75rem; color: #1565c0; border-top: 1px solid #eee;">
                            <strong>Note :</strong> L'IA r√©pond en priorit√© selon les sources de ton professeur.
                        </div>
                    </div>

                    <div class="lab-resizer" onmousedown="initResize(event, 'left', 'assistant')" ondblclick="resetLayout('left', 'assistant')"></div>
                    
                    <!-- Colonne 2 : Chat -->
                    <div class="lab-column" style="flex: 1; min-width: 200px;" id="assistant-col-chat">
                        <div style="padding: 10px 15px; background: #fff; border-bottom: 1px solid #eee; display: flex; gap: 10px;">
                            <select class="search-filter" style="font-size: 0.8rem; padding: 5px;" id="chat-subject" onchange="updateChatContext()">
                                <option value="maths">Math√©matiques</option>
                                <option value="francais">Fran√ßais</option>
                                <option value="histoire">Histoire-G√©o</option>
                            </select>
                            <select class="search-filter" style="font-size: 0.8rem; padding: 5px; flex-grow: 1;" id="chat-theme">
                                <option>Les Fractions (Cours du 15/12)</option>
                                <option>Nombres Relatifs</option>
                                <option>G√©om√©trie : Triangles</option>
                            </select>
                        </div>
                        <div id="chat-messages" style="flex-grow: 1; background: #fff; padding: 20px; overflow-y: auto; height: 400px;">
                            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                                <div style="width: 35px; height: 35px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">B</div>
                                <div style="background: #f1f2f6; padding: 12px; border-radius: 0 15px 15px 15px; max-width: 80%; font-size: 0.9rem;">
                                    Bonjour Lucas ! Je suis pr√™t √† t'aider sur les <strong>Math√©matiques</strong>. 
                                    <br><br>
                                    Tu as <strong>3 exercices</strong> en attente sur les fractions. Veux-tu qu'on les regarde ensemble ?
                                </div>
                            </div>
                        </div>
                        <div style="padding: 15px; background: #f8f9fa; border-top: 1px solid #eee; display: flex; gap: 10px; align-items: center;">
                            <label for="chat-file-upload" style="cursor: pointer; font-size: 1.2rem;" title="Joindre un fichier">üìé</label>
                            <input type="file" id="chat-file-upload" style="display: none;" onchange="handleStudentFileUpload(this)">
                            <input type="text" id="chat-input" placeholder="Pose ta question ici..." style="flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none;">
                            <button class="btn-primary" style="border-radius: 50%; width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center;" onclick="sendStudentMessage()">‚ûî</button>
                        </div>
                    </div>

                    <div class="lab-resizer" onmousedown="initResize(event, 'right', 'assistant')" ondblclick="resetLayout('right', 'assistant')"></div>

                    <!-- Colonne 3 : Workspace -->
                    <div class="lab-column" style="width: 300px; min-width: 300px;" id="assistant-col-workspace">
                        <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee;">
                            <h4 style="margin: 0; font-size: 0.9rem;">üõ†Ô∏è Outils de R√©ussite</h4>
                        </div>
                        <div style="padding: 15px; flex-grow: 1; overflow-y: auto;">
                            <h5 style="margin: 0 0 10px; font-size: 0.85rem; color: #7f8c8d; text-transform: uppercase;">G√©n√©rer pour ce cours</h5>
                            <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                                <button class="btn-small" style="background: #f0f7ff; color: #007bff; border: 1px solid #d1e9ff; text-align: left;" onclick="openAssistantConfig('quiz')">üìù G√©n√©rer un Quiz d'entra√Ænement</button>
                                <button class="btn-small" style="background: #f0f7ff; color: #007bff; border: 1px solid #d1e9ff; text-align: left;" onclick="openAssistantConfig('methode')">üß† M√©thode de r√©vision personnalis√©e</button>
                                <button class="btn-small" style="background: #f0f7ff; color: #007bff; border: 1px solid #d1e9ff; text-align: left;" onclick="openAssistantConfig('synthese')">üìÑ R√©sum√© du cours (Fiche)</button>
                                <button class="btn-small" style="background: #f0f7ff; color: #007bff; border: 1px solid #d1e9ff; text-align: left;" onclick="explainExercise()">‚ùì Expliquer l'exercice en cours</button>
                            </div>

                            <div id="assistant-workspace-output" style="margin-top: 20px; padding: 15px; background: #fff; border: 1px dashed #ddd; border-radius: 8px; min-height: 200px; font-size: 0.85rem;">
                                <p style="color: #95a5a6; text-align: center; margin-top: 50px;">Tes quiz et fiches appara√Ætront ici.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION : BLAIZ'BOT LAB (STYLE NOTEBOOK LM) -->
            <section id="section-lab" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>üß™ Blaiz'bot Lab</h1>
                        <p>Studio de recherche augment√© par l'IA (Inspir√© de NotebookLM).</p>
                    </div>
                    <div class="header-actions" id="lab-header-actions">
                        <button class="btn-primary" style="background: #9b59b6; border: none;" onclick="openCreateProjectModal('lab')">+ Nouveau Projet</button>
                    </div>
                </header>

                <!-- VUE 1 : DASHBOARD (LISTE DES PROJETS) -->
                <div id="lab-dashboard" style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;" id="lab-projects-grid">
                        <!-- Les projets s'afficheront ici -->
                        <div class="project-card-new" onclick="openCreateProjectModal('lab')">
                            <div style="font-size: 2rem; margin-bottom: 10px;">‚ûï</div>
                            <div style="font-weight: bold;">Cr√©er un nouveau projet</div>
                            <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;">Importez vos sources et commencez √† explorer</div>
                        </div>
                    </div>
                </div>

                <!-- VUE 2 : WORKSPACE (L'INTERFACE 3 COLONNES) -->
                <div id="lab-workspace-view" style="display: none;">
                    <div style="padding: 0 20px 15px; display: flex; align-items: center; gap: 15px;">
                        <button class="btn-secondary" onclick="showLabDashboard()" style="padding: 5px 10px; font-size: 0.8rem;">‚Üê Retour aux projets</button>
                        <h2 id="current-project-title" style="margin: 0; font-size: 1.1rem; color: #2c3e50;">Projet sans titre</h2>
                    </div>
                    
                    <div class="lab-container" id="lab-container">
                        
                        <!-- Colonne 1 : Sources -->
                        <div class="lab-column" style="width: 300px; min-width: 300px;" id="lab-col-sources">
                        <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; font-size: 0.9rem;">üìö Sources</h4>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn-primary" style="padding: 4px 8px; font-size: 0.7rem; background: #9b59b6; border: none;" onclick="document.getElementById('lab-source-upload').click()">+ Fichier</button>
                                <button class="btn-icon" title="Ajouter un lien Web" onclick="promptAddSource('web')">üåê</button>
                                <button class="btn-icon" title="Ajouter une vid√©o YouTube" onclick="promptAddSource('yt')">üé•</button>
                            </div>
                            <input type="file" id="lab-source-upload" style="display: none;" onchange="addLabSource(this)">
                        </div>
                        <div id="lab-sources-list" style="flex-grow: 1; overflow-y: auto; padding: 15px;">
                            <div style="text-align: center; color: #95a5a6; font-size: 0.8rem; margin-top: 20px;" id="no-sources-msg">
                                Aucune source.<br>Importez des fichiers, liens ou vid√©os.
                            </div>
                        </div>
                        <div style="padding: 12px; background: #fdf2f9; font-size: 0.75rem; color: #8e44ad; border-top: 1px solid #eee;">
                            <strong>Note :</strong> L'IA utilise ces sources comme base de connaissance exclusive.
                        </div>
                    </div>

                    <div class="lab-resizer" onmousedown="initResize(event, 'left')" ondblclick="resetLayout('left', 'lab')"></div>

                    <!-- Colonne 2 : Chat -->
                    <div class="lab-column" style="flex: 1; min-width: 200px;" id="lab-col-chat">
                        <div id="lab-chat-messages" style="flex-grow: 1; background: #fff; padding: 20px; overflow-y: auto;">
                            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                                <div style="width: 35px; height: 35px; background: #9b59b6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">L</div>
                                <div style="background: #f3e5f5; padding: 12px; border-radius: 0 15px 15px 15px; max-width: 80%; font-size: 0.9rem;">
                                    Bonjour Lucas ! Je suis ton assistant de recherche. 
                                    <br><br>
                                    Importe tes sources √† gauche pour commencer √† travailler.
                                </div>
                            </div>
                        </div>
                        <div style="padding: 15px; background: #f8f9fa; border-top: 1px solid #eee; display: flex; gap: 10px; align-items: center;">
                            <label for="lab-chat-file" style="cursor: pointer; font-size: 1.2rem;" title="Joindre un fichier au chat">üìé</label>
                            <input type="file" id="lab-chat-file" style="display: none;" onchange="handleLabChatFile(this)">
                            <input type="text" id="lab-chat-input" placeholder="Pose une question sur tes sources..." style="flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none;">
                            <button class="btn-primary" style="background: #9b59b6; border: none; border-radius: 50%; width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center;" onclick="sendLabMessage()">‚ûî</button>
                        </div>
                    </div>

                    <div class="lab-resizer" onmousedown="initResize(event, 'right')" ondblclick="resetLayout('right', 'lab')"></div>

                    <!-- Colonne 3 : Workspace -->
                    <div class="lab-column" style="width: 320px; min-width: 320px;" id="lab-col-workspace">
                        <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee;">
                            <h4 style="margin: 0; font-size: 0.9rem;">üõ†Ô∏è Espace de Travail</h4>
                        </div>
                        <div style="padding: 15px; flex-grow: 1; overflow-y: auto;">
                            
                            <h5 style="margin: 0 0 10px; font-size: 0.85rem; color: #7f8c8d; text-transform: uppercase;">G√©n√©rer des documents</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="btn-small" style="background: #f5f0ff; color: #8e44ad; border: 1px solid #d7bde2;" onclick="openLabConfig('synthese')">üìù Synth√®se</button>
                                <button class="btn-small" style="background: #f5f0ff; color: #8e44ad; border: 1px solid #d7bde2;" onclick="openLabConfig('quiz')">üé≤ Quiz</button>
                                <button class="btn-small" style="background: #f5f0ff; color: #8e44ad; border: 1px solid #d7bde2;" onclick="openLabConfig('flashcards')">üóÇÔ∏è Flashcards</button>
                                <button class="btn-small" style="background: #f5f0ff; color: #8e44ad; border: 1px solid #d7bde2;" onclick="openLabConfig('mindmap')">üß† Carte Mentale</button>
                            </div>

                            <!-- Zone de Configuration Contextuelle (Modal) -->
                            <div id="lab-config-modal" class="modal-overlay" style="display: none;">
                                <div class="modal-content" style="max-width: 400px; animation: slideIn 0.3s ease-out;">
                                    <h3 id="lab-config-title" style="margin-bottom: 15px; color: #8e44ad; display: flex; align-items: center; gap: 10px;">‚öôÔ∏è Configuration</h3>
                                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                                        Personnalisez la g√©n√©ration de votre document. Quelles sont vos instructions pour l'IA ?
                                    </p>
                                    <textarea id="lab-contextual-prompt" style="width: 100%; height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem; resize: none; margin-bottom: 20px; font-family: inherit;" placeholder="Ex: 'Fais un quiz de 5 questions difficiles', 'R√©sum√© structur√© en 3 parties'..."></textarea>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn-primary" style="flex: 2; background: #9b59b6; border: none;" id="lab-config-confirm-btn">üöÄ G√©n√©rer maintenant</button>
                                        <button class="btn-secondary" style="flex: 1;" onclick="closeLabModal()">Annuler</button>
                                    </div>
                                </div>
                            </div>

                            <div id="lab-workspace-output" style="margin-top: 20px; padding: 15px; background: #fff; border: 1px dashed #ddd; border-radius: 8px; min-height: 150px; font-size: 0.85rem;">
                                <p style="color: #95a5a6; text-align: center; margin-top: 50px;">Tes documents g√©n√©r√©s appara√Ætront ici.</p>
                            </div>
                        </div>
                    </div>

                </div>
            </section>

            <!-- SECTION : BASE DE CONNAISSANCES -->
            <section id="section-knowledge" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>üìö Base de Connaissances</h1>
                        <p>Acc√®de aux ressources officielles et g√®re tes propres fiches.</p>
                    </div>
                    <div class="header-actions">
                        <div class="tab-switcher" style="display: flex; background: #eee; padding: 5px; border-radius: 8px; gap: 5px;">
                            <button class="tab-btn active" onclick="switchKnowledgeTab('teacher')" id="tab-btn-teacher" style="padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: #fff; color: #2c3e50;">üë®‚Äçüè´ Base Professeur</button>
                            <button class="tab-btn" onclick="switchKnowledgeTab('student')" id="tab-btn-student" style="padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; background: transparent; color: #7f8c8d;">üë§ Ma Base Perso</button>
                        </div>
                    </div>
                </header>

                <!-- VUE : BASE PROFESSEUR -->
                <div id="knowledge-teacher-view" class="knowledge-content">
                    <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px; padding: 20px; height: calc(100vh - 250px);">
                        <!-- Sidebar Mati√®res -->
                        <div class="stats-card" style="padding: 0; overflow-y: auto;">
                            <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: bold;">Mati√®res</div>
                            <div id="knowledge-teacher-subjects" style="padding: 10px;">
                                <!-- Liste des mati√®res prof -->
                            </div>
                        </div>
                        <!-- Contenu Th√©matiques & Documents -->
                        <div class="stats-card" style="padding: 20px; overflow-y: auto;">
                            <div id="knowledge-teacher-details">
                                <div style="text-align: center; color: #95a5a6; margin-top: 100px;">
                                    <div style="font-size: 3rem; margin-bottom: 20px;">üìÇ</div>
                                    <h3>S√©lectionne une mati√®re pour voir les ressources</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VUE : BASE √âL√àVE -->
                <div id="knowledge-student-view" class="knowledge-content" style="display: none;">
                    <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px; padding: 20px; height: calc(100vh - 250px);">
                        <!-- Sidebar Mati√®res -->
                        <div class="stats-card" style="padding: 0; overflow-y: auto;">
                            <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
                                <span>Mes Mati√®res</span>
                                <button class="btn-icon" onclick="addStudentSubject()" title="Ajouter une mati√®re">‚ûï</button>
                            </div>
                            <div id="knowledge-student-subjects" style="padding: 10px;">
                                <!-- Liste des mati√®res √©l√®ve -->
                            </div>
                        </div>
                        <!-- Contenu Th√©matiques & Documents -->
                        <div class="stats-card" style="padding: 20px; overflow-y: auto;">
                            <div id="knowledge-student-details">
                                <div style="text-align: center; color: #95a5a6; margin-top: 100px;">
                                    <div style="font-size: 3rem; margin-bottom: 20px;">üìù</div>
                                    <h3>Organise tes propres fiches et documents</h3>
                                    <p>Tes synth√®ses g√©n√©r√©es dans le Lab peuvent √™tre enregistr√©es ici.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION : MESSAGERIE PROFESSEUR -->
            <section id="section-messages" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Centre de Communication</h1>
                        <p>√âchanges avec tes enseignants et ta classe</p>
                    </div>
                </header>
                
                <div style="display: flex; gap: 20px; height: calc(100vh - 200px);">
                    <!-- Sidebar des th√®mes -->
                    <div class="stats-card" style="flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
                        <div style="padding: 15px; border-bottom: 1px solid #eee; background: #f8f9fa;">
                            <input type="text" placeholder="Rechercher un th√®me ou prof..." style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd; font-size: 0.85rem;">
                        </div>
                        <div style="overflow-y: auto; flex-grow: 1;" id="student-conv-list">
                            <!-- G√©n√©ral -->
                            <div onclick="selectStudentChat('G√©n√©ral', 'classe')" style="padding: 12px 15px; border-bottom: 1px solid #eee; cursor: pointer; font-weight: bold; background: #f0f7ff; border-left: 4px solid #3498db; display: flex; justify-content: space-between; align-items: center;">
                                <span>üì¢ Chat de Classe (G√©n√©ral)</span>
                                <span class="status-pill" style="background: #3498db; color: white; padding: 2px 6px; font-size: 0.7rem;">3</span>
                            </div>

                            <!-- Mati√®re : Math√©matiques -->
                            <div style="background: #f8f9fa; border-bottom: 1px solid #eee;">
                                <div style="padding: 10px 15px; font-size: 0.85rem; font-weight: bold; color: #2c3e50; background: #eef2f7; display: flex; align-items: center; gap: 8px;">
                                    üìê Math√©matiques
                                </div>
                                
                                <!-- Th√®me : Fractions -->
                                <div style="padding: 5px 15px 5px 25px; background: #fff; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; border-bottom: 1px solid #f9f9f9;">
                                    üìò Th√®me : Les Fractions
                                </div>
                                <div style="background: #fff; padding-left: 25px;">
                                    <div class="msg-item" onclick="selectStudentChat('Les Fractions', 'classe')" style="padding: 8px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 0.85rem; color: #34495e;">
                                        üì¢ Chat de groupe
                                    </div>
                                    <div class="msg-item" onclick="selectStudentChat('Les Fractions', 'prof')" style="padding: 8px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center;">
                                        <span>üë§ M. DUPONT (Prof)</span>
                                        <span class="status-pill" style="background: #e74c3c; color: white; padding: 1px 5px; font-size: 0.6rem; border-radius: 10px;">1</span>
                                    </div>
                                </div>

                                <!-- Th√®me : G√©om√©trie -->
                                <div style="padding: 5px 15px 5px 25px; background: #fff; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; border-bottom: 1px solid #f9f9f9;">
                                    üìò Th√®me : G√©om√©trie
                                </div>
                                <div style="background: #fff; padding-left: 25px;">
                                    <div class="msg-item" onclick="selectStudentChat('G√©om√©trie', 'prof')" style="padding: 8px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 0.85rem;">
                                        üë§ M. DUPONT (Prof)
                                    </div>
                                </div>
                            </div>

                            <!-- Mati√®re : Fran√ßais -->
                            <div style="background: #f8f9fa; border-bottom: 1px solid #eee;">
                                <div style="padding: 10px 15px; font-size: 0.85rem; font-weight: bold; color: #2c3e50; background: #eef2f7; display: flex; align-items: center; gap: 8px;">
                                    ‚úçÔ∏è Fran√ßais
                                </div>
                                <div style="padding: 5px 15px 5px 25px; background: #fff; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; border-bottom: 1px solid #f9f9f9;">
                                    üìò Th√®me : La Po√©sie
                                </div>
                                <div style="background: #fff; padding-left: 25px;">
                                    <div class="msg-item" onclick="selectStudentChat('La Po√©sie', 'prof')" style="padding: 8px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-size: 0.85rem;">
                                        üë§ Mme. MARTIN (Prof)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fen√™tre de Chat -->
                    <div class="stats-card" style="flex: 2.5; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
                        <div id="chat-header" style="padding: 15px; border-bottom: 1px solid #eee; background: #fff;">
                            <h3 id="chat-target-name" style="margin: 0;">üì¢ Chat de Classe (G√©n√©ral)</h3>
                            <span id="chat-target-theme" style="font-size: 0.8rem; color: #3498db; font-weight: bold;">Th√®me : G√©n√©ral</span>
                        </div>

                        <div class="chat-messages" id="student-chat-messages" style="flex-grow: 1; background: #f4f7f6; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;">
                            <div class="message bot" style="align-self: flex-start; background: white; color: #2c3e50; padding: 10px 15px; border-radius: 15px 15px 15px 0; max-width: 70%; border: 1px solid #ddd;">
                                <span style="font-weight: bold; color: #3498db;">M. DUPONT :</span> Bonjour √† tous ! Bienvenue dans le fil de discussion g√©n√©ral.
                            </div>
                        </div>

                        <div style="padding: 15px; background: #fff; border-top: 1px solid #eee;">
                            <div class="chat-input" style="display: flex; gap: 10px; align-items: center;">
                                <button type="button" style="background: #95a5a6; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;" title="Joindre un fichier">üìé</button>
                                <input type="text" id="student-chat-input-text" placeholder="√âcrire un message..." style="flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <button onclick="sendStudentChatMessage()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;">Envoyer ‚û§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION : MES EXERCICES -->
            <section id="section-exercices" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Mes Exercices</h1>
                        <p>Entra√Æne-toi et progresse √† ton rythme</p>
                    </div>
                </header>
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3>Quiz : Les Fractions (Niveau 1)</h3>
                        <p>Statut : <span class="status-pill" style="background: #2ecc71; color: white;">R√©ussi</span></p>
                        <p>Score : 18/20</p>
                        <button class="btn-primary">Revoir</button>
                    </div>
                    <div class="stats-card">
                        <h3>Exercice : G√©om√©trie Plane</h3>
                        <p>Statut : <span class="status-pill" style="background: #f1c40f; color: white;">√Ä faire</span></p>
                        <p>Date limite : Demain</p>
                        <button class="btn-primary">Commencer</button>
                    </div>
                </div>
            </section>

            <!-- SECTION : PLANNING DE R√âVISION -->
            <section id="section-revisions" class="admin-section">
                <header class="content-header">
                    <div class="header-title">
                        <h1>Planning de R√©vision</h1>
                        <p>Ton agenda de cours et d'objectifs personnels</p>
                    </div>
                </header>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <button class="btn-icon" onclick="changeMonth(-1)">‚óÄ</button>
                            <h2 id="calendar-month-year" style="margin: 0; min-width: 200px; text-align: center;">D√©cembre 2025</h2>
                            <button class="btn-icon" onclick="changeMonth(1)">‚ñ∂</button>
                        </div>
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="dot teacher"></div>
                                <span>Professeur</span>
                            </div>
                            <div class="legend-item">
                                <div class="dot student"></div>
                                <span>Mes Objectifs</span>
                            </div>
                        </div>
                    </div>

                    <div class="calendar-grid" id="calendar-grid">
                        <!-- En-t√™tes des jours -->
                        <div class="calendar-day-header">Lun</div>
                        <div class="calendar-day-header">Mar</div>
                        <div class="calendar-day-header">Mer</div>
                        <div class="calendar-day-header">Jeu</div>
                        <div class="calendar-day-header">Ven</div>
                        <div class="calendar-day-header">Sam</div>
                        <div class="calendar-day-header">Dim</div>
                        
                        <!-- Les jours seront g√©n√©r√©s par JS -->
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- MODAL : CR√âATION DE PROJET LAB -->
    <div id="create-project-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 450px; animation: slideIn 0.3s ease-out;">
            <h3 id="modal-project-title" style="margin-bottom: 15px; color: #2c3e50; display: flex; align-items: center; gap: 10px;">üß™ Nouveau Projet Lab</h3>
            <p id="modal-project-desc" style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                Cr√©ez un espace de recherche libre pour vos dossiers et expos√©s.
            </p>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">TITRE DU PROJET</label>
                <input type="text" id="new-project-name" placeholder="Ex: Expos√© sur la R√©volution, Dossier √âcologie..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; outline: none; border-color: #9b59b6;">
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn-primary" style="flex: 2; background: #9b59b6; border: none;" id="confirm-create-project">üöÄ Cr√©er le projet</button>
                <button class="btn-secondary" style="flex: 1;" onclick="closeCreateProjectModal()">Annuler</button>
            </div>
        </div>
    </div>

    <!-- MODAL : SAISIE G√âN√âRIQUE (Mati√®res, Th√®mes, Docs) -->
    <div id="generic-input-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 400px; animation: slideIn 0.3s ease-out;">
            <h3 id="generic-modal-title" style="margin-bottom: 15px; color: #2c3e50;">Titre</h3>
            <input type="text" id="generic-modal-input" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; outline: none;">
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-secondary" onclick="closeGenericModal()">Annuler</button>
                <button class="btn-primary" id="generic-modal-confirm">Valider</button>
            </div>
        </div>
    </div>

    <!-- MODAL : NOUVEL √âV√âNEMENT CALENDRIER -->
    <div id="calendar-event-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px; animation: slideIn 0.3s ease-out;">
            <h3 style="margin-bottom: 20px; color: #2c3e50;">üìÖ Nouvel √âv√©nement</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Titre</label>
                <input type="text" id="event-title" placeholder="Ex: R√©viser Maths" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Date d√©but</label>
                    <input type="date" id="event-start-date" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Heure d√©but</label>
                    <input type="time" id="event-start-time" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Date fin</label>
                    <input type="date" id="event-end-date" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Heure fin</label>
                    <input type="time" id="event-end-time" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 0.8rem; font-weight: bold; color: #7f8c8d; margin-bottom: 5px;">Description / Notes</label>
                <textarea id="event-desc" rows="3" placeholder="D√©tails de l'exercice ou de la r√©vision..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; resize: none;"></textarea>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="btn-delete-event" class="btn-secondary" style="background-color: #e74c3c; color: white; border: none; display: none;" onclick="deleteCalendarEvent()">Supprimer</button>
                <button class="btn-secondary" onclick="closeCalendarModal()">Annuler</button>
                <button id="btn-save-event" class="btn-primary" onclick="saveCalendarEvent()">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Script Legacy - Utilis√© temporairement car Simple Browser VS Code ne supporte pas bien les modules ES6 -->
    <script src="student.js"></script>
    
    <!-- Modules ES6 Refactoris√©s (comment√©s pour compatibilit√© Simple Browser)
    <script type="module" src="js/student.refactored.js"></script>
    -->
</body>
</html>
